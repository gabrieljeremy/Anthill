const glob = require('glob-promise')
const mongoose = require('mongoose');
exports.register = async (server, options) => {
    if( !options.database ) throw new Error('You must define a database in the options')
    try {
        const modelsPath = options.models || '**/**/models/*.js';
        const host = options.host || 'localhost';
        const port = options.port || '27017';
        const database = options.database 
        mongoose.connect(`mongodb://${host}:${port}/${database}`)
        mongoose.Promise = global.Promise;
        mongoose.connection.on('error', err => console.error('err.message'))
        let modelsFiles = await glob.promise(modelsPath);
        modelsFiles.map(item =>require(`${process.cwd()}/${item}`))
    } catch (e) {
        console.log(e)
    }
};

exports.name = "mongoose_models"
